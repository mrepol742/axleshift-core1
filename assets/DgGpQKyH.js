/**
 * Â© 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{R as e,r as s,j as r}from"./CbKKHx2O.js";import{F as t,C as a,B as o,D as i,E as n,G as d}from"./ru3Q0AV5.js";import{R as l}from"./DfG9QjQz.js";import{e as c}from"./CWns3eDK.js";import{d as p,k as m}from"./D_eMUV-T.js";import{C as j,d as u,b as g,c as h,Q as x,R as w,S as y,T as f,V as v,W as b,U as N,X as S,a as k}from"./BCoDuBWI.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./tM1qHAtJ.js";import"./CvkuIoXT.js";import"./B3ZIOLOa.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./Eji1Pm7n.js";import"./CUBhYDUo.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B3MjVzzP.js";import"./cwKO6bxQ.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./Bd5YRvRe.js";import"./UUb1f1Eq.js";import"./DqkGgfGl.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./C76xSmx-.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./Bzwk9agu.js";import"./BqHrj3jM.js";const A=()=>{const A=p(),{id:C}=m(),_=e.useRef(),[P,E]=s.useState(!0),[I,R]=s.useState(!1),[T,O]=s.useState(""),[z,D]=s.useState({password:"",repeat_password:""}),[L,U]=s.useState(!1),[W,q]=s.useState({type:"",error:!1,message:""}),B=e=>{const{id:s,value:r}=e.target;D((e=>({...e,[s]:r})))},G=()=>{U((e=>!e))},M=[{id:1,text:"At least 8 characters",test:e=>e.length>=8},{id:2,text:"At least one uppercase letter",test:e=>/[A-Z]/.test(e)},{id:3,text:"At least one lowercase letter",test:e=>/[a-z]/.test(e)},{id:4,text:"At least one number",test:e=>/[0-9]/.test(e)},{id:5,text:"At least one special character",test:e=>/[!@#$%^&*(),.?":{}|<>]/.test(e)}],[V,X]=s.useState((F=z.password,M.map((e=>({...e,passed:e.test(F)})))));var F;s.useEffect((()=>{(async()=>{const e=await _.current.executeAsync();q({type:"",error:!1,message:""}),axios.post("/auth/forgot-password/verify",{token:C,recaptcha_ref:e}).then((e=>{if(e.data.error)return q({type:"danger",error:!0,message:e.data.error});R(!0)})).catch((e=>{var s,r;const t=(null==(r=null==(s=e.response)?void 0:s.data)?void 0:r.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);q({type:"danger",error:!0,message:t})})).finally((()=>E(!1)))})()}),[]);const H=async(e,s)=>{const r=await _.current.executeAsync();if(z.password!==z.repeat_password)return q({type:"danger",error:!0,message:"Passwords do not match"});q({type:"",error:!1,message:""}),E(!0);const t=z;t.token=C,t.recaptcha_ref=r,t.location=JSON.stringify(s),axios.post("/auth/forgot-password/reset",t).then((e=>{if(e.data.error)return q({type:"danger",error:!0,message:e.data.error});q({type:"success",error:!0,message:e.data.message}),D({password:"",repeat_password:""}),setTimeout((()=>{A("/auth/login")}),2e3)})).catch((e=>{var s,r;const t=(null==(r=null==(s=e.response)?void 0:s.data)?void 0:r.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);q({type:"danger",error:!0,message:t})})).finally((()=>E(!1)))};return r.jsxs("div",{className:"bg-dark min-vh-100 d-flex flex-row align-items-center",children:[r.jsx("div",{className:"auth-bg"}),r.jsxs(j,{children:[P&&r.jsx("div",{className:"loading-overlay",children:r.jsx(u,{color:"primary",variant:"grow"})}),!I&&r.jsx("h1",{className:"text-center",children:W?W.message:"Processing..."}),I&&r.jsx(g,{className:"justify-content-center",children:r.jsx(h,{md:8,lg:6,xl:5,children:r.jsx(x,{className:"p-1 p-sm-4 shadow",children:r.jsxs(w,{children:[W.error&&r.jsxs(y,{color:W.type,className:"d-flex align-items-center",children:[r.jsx(t,{className:"flex-shrink-0 me-2",icon:"success"===W.type?a:o,size:"xl"}),r.jsx("div",{children:W.message})]}),r.jsxs(f,{onSubmit:async e=>{e.preventDefault(),navigator.geolocation||q({type:"danger",error:!0,message:"Geolocation is not supported by this browser. Registration halted!"}),navigator.geolocation.getCurrentPosition((s=>{H(e,{latitude:s.coords.latitude,longitude:s.coords.longitude})}),(e=>{let s;switch(e.code){case e.PERMISSION_DENIED:s="We need your location to continue.";break;case e.POSITION_UNAVAILABLE:s="Location information is unavailable.";break;case e.TIMEOUT:s="Timeout occurred while getting your location.";break;default:s="An unknown error occurred. Please try again later."}return q({type:"danger",error:!0,message:s}),!0}))},children:[r.jsx("h1",{children:"Axleshift"}),r.jsx("p",{className:"text-body-secondary",children:"Set a new Password"}),r.jsxs(v,{className:"mb-3",children:[r.jsx(b,{children:r.jsx(t,{icon:i})}),r.jsx(N,{id:"password",type:L?"text":"password",placeholder:"Password",autoComplete:"current",value:z.password,onChange:e=>B(e),required:!0}),r.jsx(b,{children:r.jsx("span",{onClick:G,"aria-label":L?"Hide password":"Show password",children:r.jsx(t,{icon:L?n:d,onClick:G})})})]}),z.password.length>0&&r.jsx("ul",{children:V.map((e=>r.jsx("li",{className:""+(e.passed?"d-none":"text-small text-danger"),children:e.text},e.id)))}),r.jsxs(v,{className:"mb-3",children:[r.jsx(b,{children:r.jsx(t,{icon:i})}),r.jsx(N,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:z.repeat_password,onChange:e=>B(e),required:!0})]}),r.jsx("div",{className:"d-grid mt-2",children:r.jsx(S,{children:r.jsx(k,{type:"submit",color:"primary",className:"me-2 rounded",disabled:"success"===W.type,children:"Continue"})})})]})]})})})}),r.jsx(l,{ref:_,size:"invisible",sitekey:c})]})]})};export{A as default};
