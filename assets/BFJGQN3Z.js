/**
 * Â© 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{m as t,j as e,b as n,s as r,p as i,a as h,c as s}from"./BF0CFBFR.js";const o=t,a=new i.Planet(o),c=h.meanLunarMonth/2,m=180/Math.PI,l=new e.CalendarGregorian(-2636,2,15).toJDE();
/**
 * @copyright 2016 commenthol
 * @license MIT
 */function u(t){return(new e.CalendarGregorian).fromJDE(t).toYear()}function d(t,e){return parseFloat(t.toFixed(e),10)}class y{constructor(t,e,n,r,i){this.set(t,e,n,r,i),this._epochY=-2636,this._epoch=l,this._cache={lon:{},sue:{},ny:{}}}set(t,e,n,r,i){return t instanceof y?(this.cycle=t.cycle,this.year=t.year,this.month=t.month,this.leap=t.leap,this.day=t.day):Array.isArray(t)?(this.cycle=t[0],this.year=t[1],this.month=t[2],this.leap=t[3],this.day=t[4]):(this.cycle=t,this.year=e,this.month=n,this.leap=r,this.day=i),this}get(){return[this.cycle,this.year,this.month,this.leap,this.day]}yearFromEpochCycle(){return this._epochY+60*(this.cycle-1)+(this.year-1)}fromGregorian(t,n,r){const i=this.midnight(new e.CalendarGregorian(t,n,r).toJDE());return 1===n&&r<=20&&t--,this._from(i,t),this}fromDate(t){const n=this.midnight((new e.CalendarGregorian).fromDate(t).toJDE());return this._from(n,t.getFullYear()),this}fromJDE(t){const n=this.midnight(t),r=(new e.CalendarGregorian).fromJDE(n);return 1===r.month&&r.day<20&&r.year--,this._from(n,r.year),this}_from(t,e){let r=this.newYear(e);r>t&&(r=this.newYear(e-1));let i=this.previousNewMoon(t);i<r&&(i=r);const s=1.5+(r-this._epoch)/n.BesselianYear;this.cycle=1+Math.trunc((s-1)/60),this.year=1+Math.trunc((s-1)%60),this.month=this.inMajorSolarTerm(i).term;const o=Math.round((i-r)/h.meanLunarMonth);0===o?(this.month=1,this.leap=!1):this.leap=this.isLeapMonth(i),o>this.month?this.month=o:this.leap&&this.month--,this.day=1+Math.trunc(d(t,3)-d(i,3))}toGregorian(t){const n=this.toJDE(t),r=(new e.CalendarGregorian).fromJDE(n+.5);return{year:r.year,month:r.month,day:Math.trunc(r.day)}}toDate(t){const n=this.toJDE(t);return(new e.CalendarGregorian).fromJDE(d(n,4)).toDate()}toJDE(t){const e=t||this.yearFromEpochCycle(),n=this.newYear(e);let r=n;if(this.month>1){r=this.previousNewMoon(n+29*this.month);const t=this.inMajorSolarTerm(r).term,e=this.isLeapMonth(r);t>this.month?r=this.previousNewMoon(r-1):(t<this.month||e&&!this.leap)&&(r=this.nextNewMoon(r+1))}this.leap&&(r=this.nextNewMoon(r+1));return r+this.day-1}timeshiftUTC(t){return t.toYear()>=1929?8/24:1397/180/24}midnight(t){const n=(new e.CalendarGregorian).fromJDE(t),r=.5-this.timeshiftUTC(n);let i=Math.trunc(n.toJD()-r)+r;return i=n.fromJD(i).toJDE(),d(t,5)===d(i,5)+1?t:i}inMajorSolarTerm(t){const e=this._cache.lon[t]||r.apparentVSOP87(a,t).lon;this._cache.lon[t]=e;const n=e*m-1e-13;return{term:(2+Math.floor(n/30))%12+1,lon:n}}isLeapMonth(t){const e=this.inMajorSolarTerm(t),n=this.nextNewMoon(this.midnight(t+c)),r=this.inMajorSolarTerm(n);return e.term===r.term}nextNewMoon(t){let e=this.midnight(h.newMoon(u(t))),n=0;for(;e<t&&n++<4;)e=this.midnight(h.newMoon(u(t+n*c)));return e}previousNewMoon(t){let e=this.midnight(h.newMoon(u(t))),n=0;for(;e>t&&n++<4;)e=this.midnight(h.newMoon(u(t-n*c)));return e}newYear(t){if(t=Math.trunc(t),this._cache.ny[t])return this._cache.ny[t];const e=this._cache.sue[t-1]||s.december2(t-1,a),n=this._cache.sue[t]||s.december2(t,a);this._cache.sue[t-1]=e,this._cache.sue[t]=n;const r=this.previousNewMoon(this.midnight(n+1)),i=this.nextNewMoon(this.midnight(e+1)),o=this.nextNewMoon(this.midnight(i+c));this.leapSui=12===Math.round((r-i)/h.meanLunarMonth);let m=o;return this.leapSui&&(this.isLeapMonth(i)||this.isLeapMonth(o))&&(m=this.nextNewMoon(this.midnight(o+h.meanLunarMonth/2))),this._cache.ny[t]=m,m}solarTerm(t,e){e&&t<=3&&e--;const n=e||this.yearFromEpochCycle(),r=(t+20)%24*15%360;let i=s.longitude(n,a,r/m);return i=this.midnight(i),i}majorSolarTerm(t,e){return this.solarTerm(2*t,e)}minorSolarTerm(t,e){return this.solarTerm(2*t-1,e)}qingming(t){return this.solarTerm(5,t)}}
/**
 * @copyright 2016 commenthol
 * @license MIT
 */const M=new e.CalendarGregorian(-2333,1,27).toJDE(),p=[{date:new Date("1961-10-09T15:00:00.000Z"),shift:9/24},{date:new Date("1954-03-20T15:30:00.000Z"),shift:8.5/24},{date:new Date("1911-12-31T15:00:00.000Z"),shift:9/24},{date:new Date("1908-03-31T15:30:00.000Z"),shift:8.5/24}];class f extends y{constructor(t,e,n,r,i){super(t,e,n,r,i),this._epochY=-2333,this._epoch=M}timeshiftUTC(t){const e=t.toDate();for(const n in p)if(e>=p[n].date)return p[n].shift;return 3809/450/24}}
/**
 * @copyright 2016 commenthol
 * @license MIT
 */class w extends y{timeshiftUTC(t){return t.toYear()>=1968?7/24:8/24}}export{w as C,f as a,y as b};
