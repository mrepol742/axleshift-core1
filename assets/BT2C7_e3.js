/**
 * © 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{j as e,r as s,R as i}from"./CbKKHx2O.js";import{P as t}from"./z-cSZRUs.js";import"./55B7Qz-h.js";import{g as r,i as o,o as a,q as n,a as l,b as d,c}from"./BAxXdbTv.js";import{h as m,i as p,j as h,k as x,l as j,m as u,n as f,u as y}from"./CWns3eDK.js";import{p as g}from"./2aPQtUzY.js";import{F as v,M as b,N as w,O as N,P as k,Q as I,m as _}from"./ru3Q0AV5.js";import{F as S}from"./BIMKh3mD.js";import{d as R}from"./D_eMUV-T.js";import{P as C,B as O,I as q,F as z,O as B}from"./DFu6bisY.js";import{S as U,d as W,Q as M}from"./BCoDuBWI.js";import"./D9QqU1Un.js";import"./CFK1l90-.js";import"./tM1qHAtJ.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./CvkuIoXT.js";import"./B3ZIOLOa.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./Eji1Pm7n.js";import"./CUBhYDUo.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B3MjVzzP.js";import"./cwKO6bxQ.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./Bd5YRvRe.js";import"./UUb1f1Eq.js";import"./DqkGgfGl.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./C76xSmx-.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./Bzwk9agu.js";import"./BqHrj3jM.js";import"./B3URu6im.js";import"./GFHO7GOQ.js";import"./DtKOklRo.js";import"./BdNtXUTk.js";import"./DoBxDInM.js";import"./DNTNCEjc.js";import"./CkaobMAX.js";import"./C_Q1Zl_5.js";let A=r(o({apiKey:f,authDomain:u,projectId:j,storageBucket:x,messagingSenderId:h,appId:p,measurementId:m}));const D=({threadsID:s,selectedUser:i,handleSelectUser:t,isMobile:r})=>e.jsxs("div",{className:"border-end",style:{width:r?"100%":"30%",overflowY:"auto",height:r?"100%":"auto"},children:[e.jsx("h2",{className:"mx-3 my-2",children:"Messages"}),s.map(((s,r)=>e.jsxs("div",{onClick:()=>t(s),className:`${(null==i?void 0:i.sender_id)===s.sender_id&&"bg-body-secondary"} d-flex align-items-center px-3 py-2 border-bottom`,style:{cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{className:"bg-primary rounded-pill me-3 d-flex justify-content-center align-items-center text-white",style:{width:"36px",height:"36px"},children:s.sender_id.slice(0,1).toUpperCase()}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:`${(null==i?void 0:i.sender_id)===s.sender_id&&"fw-bold"}`,style:{fontSize:"14px"},children:s.sender_id.slice(0,6).toUpperCase()}),e.jsxs("div",{style:{fontSize:"11px"},className:"text-muted",children:[g(s.timestamp)," ·"," ",s.message.slice(0,30)+"..."]})]})]},r)))]});D.propTypes={threadsID:t.arrayOf(t.shape({id:t.string.isRequired,timestamp:t.oneOfType([t.string,t.number]).isRequired})).isRequired,selectedUser:t.shape({sender_id:t.string}),handleSelectUser:t.func.isRequired,isMobile:t.bool.isRequired};const T=({isOpen:t,setIsOpen:r,messagesRef:o,selectedUser:c,handleBackToList:m,isMobile:p,showBackButton:h})=>{const x=R(),j=new S,[u,f]=s.useState([]),[W,M]=s.useState(""),[A,D]=s.useState(!1),T=i.useRef(null),{user:H}=y();s.useEffect((()=>{if(!c)return;const e=a(n(o,l("timestamp")),(e=>{const s=e.docs.map((e=>({id:e.id,...e.data()}))).filter((e=>e.sender_id===c.sender_id||e.sender_id===H.ref));f(s)}));return()=>e()}),[c]),s.useEffect((()=>{T.current&&T.current.scrollIntoView({behavior:"smooth"})}),[u,c]);const E=async()=>{""!==W.trim()&&c&&(await d(o,{message:j.clean(W),role:H.role,timestamp:Date.now(),sender_id:c.sender_id}),M(""))},L=e.jsxs(C,{id:"popover-basic",style:{maxWidth:"300px",zIndex:9999},children:[e.jsx(C.Header,{as:"h3",children:"Quick Messages"}),e.jsx(C.Body,{children:e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:["When will my shipment be dispatched?","What documents are required for customs clearance?","Can you confirm the estimated arrival date of my freight?","How can I update the delivery address or contact details?","Are there any special handling instructions I should be aware of?","How do I schedule a pickup for my next shipment?","What are the charges for expedited shipping?","Can I track my shipment in real-time?","What should I do if my shipment is delayed?","Are there any restrictions on the type of goods I can ship?","How do I file a claim for a damaged shipment?","What are the weight and size limits for freight shipments?","Can I request a specific delivery time for my shipment?","What payment methods do you accept for freight services?","How do I cancel or reschedule a shipment?"].map(((s,i)=>e.jsx("div",{className:"p-2 mb-1 border-bottom",style:{cursor:"pointer"},onClick:()=>(M(s),void D(!1)),children:s},i)))})})]}),Y=e=>e.role===H.role;return e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",height:p?"100%":"auto"},children:c?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column justify-content-between h-100",children:[e.jsxs("div",{className:"d-flex justify-content-between px-2 py-1 m-1 rounded bg-body-secondary",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[h&&!t&&e.jsx(O,{variant:"link",onClick:m,children:e.jsx(v,{icon:b})}),e.jsx("div",{className:"bg-primary fw-bold rounded-pill me-2 d-flex justify-content-center align-items-center text-white",style:{width:"40px",height:"40px"},children:c.sender_id.slice(0,1).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontSize:p?"16px":"18px"},children:H.ref===c.sender_id?"You":c.sender_id.slice(0,6).toUpperCase()}),e.jsx("div",{className:"text-muted",style:{fontSize:"13px"},children:c.sender_id})]})]}),t&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:" btn",onClick:()=>x("/customer"),children:e.jsx(v,{icon:w})}),e.jsx("div",{className:"btn",onClick:()=>r(!1),children:e.jsx(v,{icon:N})})]})]}),e.jsxs("div",{className:"flex-grow-1 p-3",style:{overflowY:"auto"},children:[t?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsxs(U,{color:"warning",className:"mb-3 mt-3 small",children:[e.jsx("strong",{children:"Warning: "}),"Always chat and complete",e.jsx("br",{}),"transactions within Axleshift ",e.jsx("br",{}),"to protect yourself from scams. Axleshift will never ask you"," ",e.jsx("br",{}),"to send money or share personal information ",e.jsx("br",{}),"outside of the platform. ",e.jsx("br",{}),"If you receive any ",e.jsx("br",{}),"suspicious messages or requests, ",e.jsx("br",{}),"please report them immediately. ",e.jsx("br",{}),"Your safety is our priority."]})}):e.jsx("div",{className:"d-flex justify-content-center",children:e.jsxs(U,{color:"warning",className:"mb-3 mt-3 small",children:[e.jsx("strong",{children:"Warning: "}),"Always chat and complete transactions within Axleshift to protect yourself from scams. Axleshift will never ask you to send money or share personal information outside of the platform. ",e.jsx("br",{}),"If you receive any suspicious messages or requests, please report them immediately. Your safety is our priority."]})}),u.map(((s,i)=>e.jsxs("div",{style:{textAlign:Y(s)?"right":"left",marginBottom:"12px"},children:[e.jsx("div",{className:(Y(s)?"bg-primary":"bg-secondary")+" text-white rounded p-2",style:{display:"inline-block",maxWidth:p?"85%":"80%",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative",wordBreak:"break-word"},children:e.jsx("div",{style:{fontSize:p?"13px":"14px"},children:s.message.split(/(https?:\/\/[^\s]*axleshift\.com[^\s]*|\b(?:\w+\.)?axleshift\.com[^\s]*)/g).map(((s,i)=>{if(/(https?:\/\/[^\s]*axleshift\.com[^\s]*|\b(?:\w+\.)?axleshift\.com[^\s]*)/.test(s)){const t=s.startsWith("http")?s:`https://${s}`;return e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",style:{color:"lightblue",textDecoration:"underline"},children:s},i)}return s}))})}),e.jsx("div",{style:{fontSize:"11px",color:"gray",marginTop:"4px",textAlign:Y(s)?"right":"left",paddingLeft:Y(s)?"0":"12px",paddingRight:Y(s)?"12px":"0"},children:g(s.timestamp)})]},i))),e.jsx("div",{ref:T})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(q,{className:"mt-2",children:[e.jsx(z,{as:"textarea",placeholder:"Type a message...",value:W,className:"border-primary border",onChange:e=>M(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},style:{padding:"10px",resize:"none",minHeight:"45px",maxHeight:"45px",overflowY:"auto",fontSize:"12px"}}),"user"===H.role&&e.jsx(B,{trigger:"click",placement:"top",overlay:L,rootClose:!0,children:e.jsx(O,{style:{height:"45px"},children:e.jsx(v,{icon:k})})}),e.jsx(O,{style:{height:"45px"},onClick:E,children:e.jsx(v,{icon:I})})]})})]})}):e.jsxs("div",{className:"d-flex justify-content-center align-items-center h-100 flex-column",children:[e.jsx("div",{className:"bg-primary rounded-pill d-flex justify-content-center align-items-center mb-3",style:{width:"70px",height:"70px"},children:e.jsx(v,{icon:_,size:"2x"})}),e.jsx("p",{children:"Select a user to view conversation"})]})})};T.propTypes={isOpen:t.bool,setIsOpen:t.func,messagesRef:t.object.isRequired,selectedUser:t.shape({sender_id:t.string,ref:t.string}),handleBackToList:t.func.isRequired,isMobile:t.bool.isRequired,showBackButton:t.bool.isRequired};const H=({float:i,isOpen:t,setIsOpen:r})=>{const[o,d]=s.useState(!1),[m,p]=s.useState(null),[h,x]=s.useState(!1),[j,u]=s.useState(!0),[f,g]=s.useState([]),{user:v}=y(),b=c(A,"messages");s.useEffect((()=>{const e=new URLSearchParams(window.location.search).get("ref");if(!v._id)return;if(v&&!m&&"user"===v.role)return p({sender_id:v.ref});d(!0),e&&p({sender_id:e});const s=a(n(b,l("timestamp")),(s=>{let i=new Map,t=[];if(s.docs.reverse().forEach((s=>{const r={id:s.id,...s.data()};(!t.includes(r.sender_id)||e&&r.sender_id===e)&&(i.set(r.sender_id,r),t.push(r.sender_id))})),e&&!t.includes(e)){const s=new Map;s.set(e,{id:e,sender_id:e,message:"",role:"user",timestamp:Date.now()}),i=new Map([...s,...i])}const r=Array.from(i.values());g(r),d(!1)})),i=()=>{x(window.innerWidth<768)};return i(),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),s()}}),[v]);return o?e.jsx("div",{className:"loading-overlay",children:e.jsx(W,{color:"primary",variant:"grow"})}):b?e.jsx("div",{className:"mb-3",children:e.jsx(M,{children:e.jsxs("div",{className:"d-flex",style:{height:h?"calc(100vh - 180px)":i?"40vh":"70vh",flexDirection:h?"column":"row"},children:["user"!==(null==v?void 0:v.role)&&(!h||h&&j)&&!i&&e.jsx(D,{threadsID:f,selectedUser:m,handleSelectUser:e=>{p(e),h&&u(!1)},isMobile:h}),("user"===(null==v?void 0:v.role)||!h||h&&!j||t)&&e.jsx(T,{isOpen:t,setIsOpen:r,messagesRef:b,selectedUser:m,handleBackToList:()=>{h&&u(!0)},isMobile:h,showBackButton:h&&"user"!==(null==v?void 0:v.role)})]})})}):e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"70vh"},children:e.jsx("p",{children:"No messages yet"})})};H.propTypes={float:t.bool,isOpen:t.bool,setIsOpen:t.func};export{H as default};
