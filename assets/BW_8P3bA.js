/**
 * © 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{r as e,j as t}from"./CbKKHx2O.js";import{H as s}from"./VudaBnFI.js";import{u as a,b as r}from"./CWns3eDK.js";import{d as n}from"./D_eMUV-T.js";import{d as i,ao as l,U as o,al as c,a as d,q as p,r as m,s as u,z as h,a2 as x,a3 as j,a4 as v,a5 as g,a6 as y,b as f,c as b}from"./BCoDuBWI.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./Bnu3OxD9.js";import"./BNqS-k40.js";import"./0NUvlLuB.js";import"./tM1qHAtJ.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./CvkuIoXT.js";import"./B3ZIOLOa.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./Eji1Pm7n.js";import"./CUBhYDUo.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B3MjVzzP.js";import"./cwKO6bxQ.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./Bd5YRvRe.js";import"./UUb1f1Eq.js";import"./ru3Q0AV5.js";import"./DqkGgfGl.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./C76xSmx-.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./Bzwk9agu.js";import"./BqHrj3jM.js";const w=()=>{const{user:w}=a(),[D,S]=e.useState({endDate:"",startDate:"",status:"",invoiceStatus:"",type:"",query:"",weight:""}),[N,C]=e.useState([]),[_,k]=e.useState(1),[T,P]=e.useState(0),[A,E]=e.useState(!1),{addToast:F}=r();n();const G=async(e,t=null)=>{E(!0),axios.post("/freight/deep-search",{page:e,...D,export_type:t}).then((e=>{const t=e.headers["content-type"];if(["text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t)){const s=new Blob([e.data],{type:t}),a=window.URL.createObjectURL(s),r=document.createElement("a");return r.href=a,r.download=(new Date).toDateString()+" Freight Report."+("text/csv"===t?"csv":"xlsx"),document.body.appendChild(r),r.click(),void document.body.removeChild(r)}const s=D.invoiceStatus?e.data.data.filter((e=>{var t;return(null==(t=e.invoice)?void 0:t.status)===D.invoiceStatus})):e.data.data;C(s),P(Math.ceil(s.length/e.data.pageSize))})).catch((e=>{var t,s;const a=(null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);F(a)})).finally((()=>E(!1)))};e.useEffect((()=>{G(_)}),[_]);const K=(e,t)=>{S((s=>({...s,[e]:t})))};return t.jsxs("div",{children:[t.jsx(s,{children:t.jsx("title",{children:"Reports | Axleshift"})}),A&&t.jsx("div",{className:"loading-overlay",children:t.jsx(i,{color:"primary",variant:"grow"})}),t.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"6px",overflowY:"auto"},children:[t.jsx(l,{children:"Start Date:"}),t.jsx(o,{type:"date",max:D.endDate||"",onChange:e=>{const t=e.target.value;D.endDate&&new Date(t)>new Date(D.endDate)?F("Start date cannot be after end date"):K("startDate",t)}}),t.jsx(l,{children:"End Date:"}),t.jsx(o,{type:"date",min:D.startDate||"",onChange:e=>{const t=e.target.value;D.startDate&&new Date(t)<new Date(D.startDate)?F("End date cannot be before start date"):K("endDate",t)}}),t.jsxs(c,{style:{minWidth:"140px"},onChange:e=>K("status",e.target.value),children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"to_pay",children:"To Pay"}),t.jsx("option",{value:"to_ship",children:"To Ship"}),t.jsx("option",{value:"to_receive",children:"To Receive"}),t.jsx("option",{value:"received",children:"Received"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]}),t.jsxs(c,{style:{minWidth:"120px"},onChange:e=>K("type",e.target.value),children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"private",children:"Private"}),t.jsx("option",{value:"business",children:"Business"})]}),t.jsxs(c,{style:{minWidth:"110px"},onChange:e=>K("invoiceStatus",e.target.value),children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"PAID",children:"Paid"}),t.jsx("option",{value:"EXPIRED",children:"Expired"})]}),t.jsxs(c,{style:{minWidth:"100px"},onChange:e=>K("weight",e.target.value),children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"1",children:"< 1 KG"}),t.jsx("option",{value:"5",children:"< 5KG "}),t.jsx("option",{value:"10",children:"< 10KG "}),t.jsx("option",{value:"20",children:"< 20KG "}),t.jsx("option",{value:"40",children:"< 40KG "}),t.jsx("option",{value:"60",children:"< 60KG "}),t.jsx("option",{value:"70",children:"< 70KG "}),t.jsx("option",{value:"71",children:"> 71KG "})]}),t.jsx(o,{style:{minWidth:"200px"},placeholder:"Tracking number",onChange:e=>K("query",e.target.value)}),t.jsx(d,{color:"primary",onClick:e=>G(_),children:"Apply Filters"})]}),t.jsx("h4",{className:"text-muted",children:"Summary"}),t.jsxs("div",{className:"d-block d-md-flex justify-content-between mb-2",children:[t.jsx("div",{children:t.jsxs("h5",{children:["Shipments: ",N.length," ·"," ",["super_admin","admin"].includes(w.role)&&t.jsxs(t.Fragment,{children:["Customers: ",(()=>{const e=new Set;for(let t=0;t<N.length;t++){const s=N[t];s.user&&e.add(s.user.first_name+" "+s.user.last_name)}return e.size})()]})," ","· Amount:"," ",new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(N.reduce(((e,t)=>e+t.amount.value),0))," ","· Weight: ",N.reduce(((e,t)=>e+t.total_weight),0)," KG"]})}),t.jsxs("div",{children:[t.jsx(d,{className:"me-2",color:"primary",onClick:()=>{S({endDate:"",startDate:"",status:"",invoiceStatus:"",type:"",query:"",weight:""}),G(_)},disabled:!(""!==(D.startDate||D.endDate||D.status||D.type||D.query||D.weight)),children:"Clear Filters"}),t.jsxs(p,{className:"bg-primary",children:[t.jsx(m,{caret:!1,children:"Export"}),t.jsxs(u,{children:[t.jsx(h,{className:"d-flex align-items-center",as:"button",type:"button",onClick:e=>G(_,"csv"),children:"CSV"}),t.jsx(h,{className:"d-flex align-items-center",as:"button",type:"button",onClick:e=>G(_,"excel"),children:"Excel"})]})]})]})]}),t.jsxs(x,{stripedColumns:!0,hover:!0,responsive:!0,className:"table-even-width",children:[t.jsx(j,{children:t.jsxs(v,{children:[t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Tracking Number"}),["super_admin","admin"].includes(w.role)&&t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Customer"}),t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Status"}),t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Type"}),t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Amount"}),t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Payment"}),t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Date"}),t.jsx(g,{className:"text-uppercase fw-bold text-muted poppins-regular table-header-cell-no-wrap",children:"Weight"})]})}),0!==N.length&&t.jsx(y,{children:N.map(((e,s)=>{return t.jsxs(v,{children:[t.jsx(g,{children:e.tracking_number}),["super_admin","admin"].includes(w.role)&&t.jsx(g,{children:e.user.first_name+" "+e.user.last_name}),t.jsx(g,{children:(a=e.status,"cancelled"===a?"Cancelled":"received"===a?"Received":"to_receive"===a?"To Receive":"to_ship"===a?"To Ship":"To Pay")}),t.jsx(g,{className:"text-capitalize",children:e.type}),t.jsx(g,{children:new Intl.NumberFormat("en-US",{style:"currency",currency:e.amount.currency}).format(e.amount.value)}),t.jsx(g,{children:e.invoice?t.jsx(t.Fragment,{children:"PAID"===e.invoice.status?t.jsxs(t.Fragment,{children:[e.invoice.status," via"," ",e.invoice.payment_method]}):t.jsx(t.Fragment,{children:e.invoice.status})}):"NaN"}),t.jsx(g,{children:new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),t.jsx(g,{children:e.total_weight+"kg"})]},s);var a}))})]}),0===N.length&&t.jsx(f,{className:"justify-content-center my-5",children:t.jsxs(b,{md:6,children:[t.jsx("h1",{className:"text-truncate text-center",children:D.query}),t.jsxs("div",{className:"clearfix",children:[t.jsx("h1",{className:"float-start display-3 me-4 text-danger",children:"OOPS"}),t.jsx("h4",{children:"There was no shipment found."}),t.jsx("p",{children:"Double check your search query."})]})]})})]})};export{w as default};
