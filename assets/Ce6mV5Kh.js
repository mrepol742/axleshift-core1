/**
 * Â© 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{R as e,r as s,j as a}from"./CbKKHx2O.js";import{F as r,R as t,m as o,n as i,S as n,H as l,I as c,J as d,B as m,D as p,E as u,G as h}from"./ru3Q0AV5.js";import{R as j}from"./DfG9QjQz.js";import{u as x,b as g,V as f,e as w}from"./CWns3eDK.js";import{d as b,Q as v,R as y,T as N,A as C,U as _,V as S,W as k,b as z,c as A,a as R,S as D}from"./BCoDuBWI.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./tM1qHAtJ.js";import"./D_eMUV-T.js";import"./CvkuIoXT.js";import"./B3ZIOLOa.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./Eji1Pm7n.js";import"./CUBhYDUo.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B3MjVzzP.js";import"./cwKO6bxQ.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./Bd5YRvRe.js";import"./UUb1f1Eq.js";import"./DqkGgfGl.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./C76xSmx-.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./Bzwk9agu.js";import"./BqHrj3jM.js";const T=()=>{const{user:m,setUser:p}=x(),u=e.useRef(),h=Intl.supportedValuesOf("timeZone"),{addToast:D}=g(),[T,q]=s.useState({username:m.username,email:m.email,first_name:m.first_name,last_name:m.last_name,timezone:m.timezone}),[I,O]=s.useState(!1),F=e=>{const{name:s,value:a}=e.target;return q((e=>({...e,[s]:a})))};return a.jsxs("div",{children:[I&&a.jsx("div",{className:"loading-overlay",children:a.jsx(b,{color:"primary",variant:"grow"})}),a.jsx("h4",{children:"Account details"}),a.jsx(v,{className:"mb-3",children:a.jsx(y,{children:a.jsxs(N,{onSubmit:e=>(async e=>{if(e.preventDefault(),T.username===m.username&&T.email===m.email&&T.first_name===m.first_name&&T.last_name===m.last_name&&T.timezone===m.timezone)return D("No changes detected.");const s=await u.current.executeAsync();O(!0),axios.post("/auth/user",{...T,recaptcha_ref:s}).then((e=>{if(e.data.error)return D(e.data.error);p(e.data),D("Your changes has been saved.")})).catch((e=>{var s,a;const r=(null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);D(r)})).finally((()=>O(!1)))})(e),children:[m.avatar?a.jsx(a.Fragment,{children:a.jsx(C,{crossOrigin:"Anonymous",src:`${f}/images/${m.avatar}.png`,className:"rounded-pill p-1 border mb-3",width:"100px",height:"100px",loading:"lazy"})}):a.jsx("div",{className:"rounded-pill bg-primary d-flex align-items-center justify-content-center mb-3 fs-4",style:{width:"70px",height:"70px",color:"white"},children:(U=m.first_name,U?U.charAt(0).toUpperCase():"")}),a.jsx(r,{id:"faCamera",icon:t,className:"position-absolute bg-secondary p-2 rounded-pill bg-opacity-50",style:{top:"50px",left:"50px",cursor:"pointer"},onClick:()=>{document.querySelector('input[name="profile_pic"]').click()}}),a.jsx(_,{className:"d-none",name:"profile_pic",type:"file",accept:"image/*",onChange:e=>{(async e=>{e.preventDefault();const s=await u.current.executeAsync();O(!0);const a=new FormData;a.append("profile_pic",e.target.files[0]),a.append("recaptcha_ref",s),axios.post("/auth/upload",a,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(e.data.error)return D(e.data.error);D("Your profile picture has been updated.")})).catch((e=>{var s,a;const r=(null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);D(r)})).finally((()=>O(!1)))})(e)}}),a.jsxs(S,{className:"mb-3",children:[a.jsx(k,{children:a.jsx(r,{icon:o})}),a.jsx(_,{type:"text",name:"username",placeholder:"Username",autoComplete:"username",value:T.username,onChange:e=>F(e)})]}),a.jsxs(S,{className:"mb-3",children:[a.jsx(k,{children:a.jsx(r,{icon:i})}),a.jsx(_,{type:"email",name:"email",placeholder:"Email",autoComplete:"email",value:T.email,onChange:e=>F(e)})]}),a.jsxs(z,{children:[a.jsx(A,{md:6,className:"mb-3",children:a.jsxs(S,{children:[a.jsx(k,{children:a.jsx(r,{icon:o})}),a.jsx(_,{name:"first_name",type:"text",placeholder:"First Name",autoComplete:"given-name",value:T.first_name,onChange:e=>F(e)})]})}),a.jsx(A,{md:6,className:"mb-3",children:a.jsxs(S,{children:[a.jsx(k,{children:a.jsx(r,{icon:o})}),a.jsx(_,{name:"last_name",type:"text",placeholder:"Last Name",autoComplete:"family-name",value:T.last_name,onChange:e=>F(e)})]})})]}),a.jsxs(S,{className:"mb-2 d-none",children:[a.jsx(k,{children:a.jsx(r,{icon:n})}),a.jsx(_,{type:"text",name:"timezone",placeholder:"Timezone",list:"timezone-options",value:T.timezone,onChange:e=>F(e)}),a.jsx("datalist",{id:"timezone-options",children:h.map((e=>a.jsx("option",{value:e},e)))})]}),a.jsxs("div",{className:"mb-3",children:[a.jsxs(R,{color:"primary",className:"mb-1 me-2 rounded",size:"sm",disabled:m.oauth2&&m.oauth2.google,children:[a.jsx(r,{icon:l,className:"me-1"})," ",m.oauth2&&m.oauth2.google?m.oauth2.google.email:"Connect Google"]}),a.jsxs(R,{color:"primary",className:"mb-1 me-2 rounded",size:"sm",disabled:m.oauth2&&m.oauth2.github,children:[a.jsx(r,{icon:c,className:"me-1"})," ",m.oauth2&&m.oauth2.github?m.oauth2.github.email:"Connect Github"]}),a.jsxs(R,{color:"primary",className:"mb-1 me-2 rounded",size:"sm",disabled:m.oauth2&&m.oauth2.microsoft,children:[a.jsx(r,{icon:d,className:"me-1"})," ",m.oauth2&&m.oauth2.microsoft?m.oauth2.microsoft.email:"Connect Microsoft"]})]}),a.jsx(R,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})}),a.jsx(j,{ref:u,size:"invisible",sitekey:w})]});var U},q=()=>{const{user:t}=x(),o=e.useRef(),[i,n]=s.useState(!1),[l,c]=s.useState({password:"",new_password:"",repeat_password:""}),[d,g]=s.useState(!1),[f,C]=s.useState(!1),[z,A]=s.useState({error:!1,message:""}),T=e=>{const{id:s,value:a}=e.target;c((e=>({...e,[s]:a})))},q=[{id:1,text:"At least 8 characters",test:e=>e.length>=8},{id:2,text:"At least one uppercase letter",test:e=>/[A-Z]/.test(e)},{id:3,text:"At least one lowercase letter",test:e=>/[a-z]/.test(e)},{id:4,text:"At least one number",test:e=>/[0-9]/.test(e)},{id:5,text:"At least one special character",test:e=>/[!@#$%^&*(),.?":{}|<>]/.test(e)}],I=e=>q.map((s=>({...s,passed:s.test(e)}))),[O,F]=s.useState(I(l.new_password));return a.jsxs("div",{children:[i&&a.jsx("div",{className:"loading-overlay",children:a.jsx(b,{color:"primary",variant:"grow"})}),a.jsxs("h4",{children:["OK"===t.password?"Change":"Set"," Password"]}),a.jsx(v,{className:"mb-3",children:a.jsxs(y,{children:[z.error&&a.jsxs(D,{color:"danger",className:"d-flex align-items-center",children:[a.jsx(r,{className:"flex-shrink-0 me-2",icon:m,size:"xl"}),a.jsx("div",{children:z.message})]}),a.jsxs(N,{onSubmit:async e=>{e&&e.preventDefault();const s=await o.current.executeAsync();n(!0),axios.post("/auth/password",{...l,recaptcha_ref:s}).then((e=>{if(e.data.error)return A({error:!0,message:e.data.error});window.location.reload()})).catch((e=>{var s,a;const r=(null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);A({error:!0,message:r})})).finally((()=>n(!1)))},children:["OK"===t.password&&a.jsxs(S,{className:"mb-3",children:[a.jsx(k,{children:a.jsx(r,{icon:p})}),a.jsx(_,{id:"password",type:d?"text":"password",placeholder:"Password",autoComplete:"current-password",value:l.password,onChange:e=>T(e),required:!0}),a.jsx(k,{children:a.jsx("span",{onClick:e=>g(!d),"aria-label":d?"Hide password":"Show password",children:a.jsx(r,{icon:d?u:h,onClick:e=>g(!d)})})})]}),a.jsxs(S,{className:"mb-3",children:[a.jsx(k,{children:a.jsx(r,{icon:p})}),a.jsx(_,{id:"new_password",type:f?"text":"password",placeholder:"New Password",autoComplete:"new-password",value:l.new_password,onChange:e=>(e=>{T(e),"new_password"===e.target.id&&F(I(e.target.value))})(e),required:!0}),a.jsx(k,{children:a.jsx("span",{onClick:e=>C(!f),"aria-label":f?"Hide password":"Show password",children:a.jsx(r,{icon:f?u:h,onClick:e=>C(!f)})})})]}),l.new_password.length>0&&a.jsx("ul",{children:O.map((e=>a.jsx("li",{className:"text-"+(e.passed?"success":"danger"),children:e.text},e.id)))}),a.jsxs(S,{className:"mb-3",children:[a.jsx(k,{children:a.jsx(r,{icon:p})}),a.jsx(_,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:l.repeat_password,onChange:e=>T(e),required:!0})]}),a.jsx(R,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})]})}),a.jsx(j,{ref:o,size:"invisible",sitekey:w})]})},I=()=>{const{user:r}=x(),t=e.useRef(),{addToast:o}=g(),[i,n]=s.useState(!1);return a.jsxs("div",{children:[a.jsx("h4",{children:"Download Your Info"}),a.jsx(v,{className:"mb-3",children:a.jsxs(y,{children:[a.jsx("p",{children:"If you wish to download your account information, please note that this action will create a zip file containing all your data."}),a.jsx(R,{type:"submit",color:"success",className:"mt-4 d-block me-2 rounded text-start",disabled:!0,children:"Download"})]})}),a.jsx("h4",{children:"Delete account"}),a.jsx(v,{className:"mb-3",children:a.jsxs(y,{children:[a.jsxs("p",{children:["If you wish to delete your account, please note that this action is irreversible and will remove all your data permanently.",a.jsx("br",{}),"To proceed with the deletion of your account, please click the button below:"]}),a.jsx("span",{className:"text-muted",children:"We cannot process your account deletion request, if you have unpaid invoices or inroute shippment"}),a.jsx(R,{type:"submit",color:"danger",className:"mt-4 d-block me-2 rounded",disabled:!0,children:"Request account deletion"})]})}),a.jsx(j,{ref:t,size:"invisible",sitekey:w})]})},O=()=>{const{user:e}=x();return a.jsx("div",{className:"d-flex flex-column",children:a.jsxs(z,{children:[a.jsx(A,{xs:12,md:6,lg:5,xl:4,children:a.jsx(T,{})}),a.jsx(A,{xs:12,md:6,lg:5,xl:4,children:a.jsx(q,{})}),"user"===e.role&&a.jsx(A,{xs:12,md:6,lg:5,xl:4,children:a.jsx(I,{})})]})})};export{O as default};
