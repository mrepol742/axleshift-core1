/**
 * Â© 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{R as s,r as e,j as i}from"./CbKKHx2O.js";import{R as a}from"./DfG9QjQz.js";import{F as r,a2 as t}from"./ru3Q0AV5.js";import{u as o,G as l,M as n}from"./Dc8uJUlf.js";import{b as c,e as d,o as m}from"./CWns3eDK.js";import{A as j}from"./schw12Bp.js";import{p}from"./2aPQtUzY.js";import{d as x,b as u,c as h,Q as g,R as f,a as b,e as v,f as y,g as N,h as _,i as k}from"./BCoDuBWI.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./CvkuIoXT.js";import"./B3ZIOLOa.js";import"./tM1qHAtJ.js";import"./D_eMUV-T.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./Eji1Pm7n.js";import"./CUBhYDUo.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B3MjVzzP.js";import"./cwKO6bxQ.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./Bd5YRvRe.js";import"./UUb1f1Eq.js";import"./DqkGgfGl.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./C76xSmx-.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./Bzwk9agu.js";import"./BqHrj3jM.js";const C=()=>{const{isLoaded:C}=o({id:"google-map-script",googleMapsApiKey:m}),S=s.useRef(),{addToast:w}=c(),[L,P]=e.useState(!0),[z,A]=e.useState([]),[T,F]=e.useState(1),[M,O]=e.useState(0),[R,G]=e.useState(!1),[I,J]=e.useState(!1),[E,K]=e.useState(null),[Q,V]=e.useState(null);s.useCallback((function(s){V(s)}),[]),s.useCallback((function(s){V(null)}),[]);const W=async s=>{const e=await S.current.executeAsync();P(!0),axios.post("/sec/sessions/logout",{session_id:s,recaptcha_ref:e}).then((e=>{w(e.data.message),A(s?e=>({...e,sessions:e.sessions.filter((e=>e._id!==s))}):s=>({...s,sessions:[]}))})).catch((s=>{var e,i;const a=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);w(a)})).finally((()=>P(!1)))};return e.useEffect((()=>{(async s=>{axios.post("/sec/sessions",{page:s}).then((s=>{A(s.data.data),O(s.data.totalPages)})).catch((s=>{var e,i;const a=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);w(a)})).finally((()=>P(!1)))})(T)}),[T]),L?i.jsx("div",{className:"loading-overlay",children:i.jsx(x,{color:"primary",variant:"grow"})}):i.jsxs("div",{children:[i.jsxs(u,{xs:{cols:1},sm:{cols:2},children:[i.jsxs(h,{className:"mb-3",children:[i.jsx("h4",{children:"This device"}),i.jsx(g,{children:i.jsxs(f,{children:[i.jsxs("div",{className:"d-flex justify-content-between",children:[i.jsx("p",{className:"display-3",children:"::1"===z.current_session.ip_address||"::ffff:127.0.0.1"===z.current_session.ip_address?"localhost":z.current_session.ip_address}),i.jsx("span",{onClick:s=>{K(z.current_session),J(!0)},children:i.jsx(r,{icon:t,size:"xl"})})]}),i.jsx("span",{className:"lead",children:z.current_session.user_agent})]})})]}),i.jsxs(h,{className:"mb-3",children:[i.jsx("h4",{children:"Logout other sessions"}),i.jsx(g,{children:i.jsxs(f,{children:[i.jsx("p",{children:"Clearing all device sessions will log you out from all devices and browsers, except for the one you're currently using."}),i.jsx(b,{type:"submit",color:"danger",className:"mt-4 d-block me-2 rounded",disabled:z.logout,onClick:s=>G(!0),children:"Logout other sessions"})]})})]})]}),z.sessions.map(((s,e)=>i.jsxs("div",{children:[i.jsx(g,{className:"mb-3",children:i.jsxs(f,{children:[i.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[i.jsx("h3",{className:(s.active?"text-primary":"")+" text-truncate",children:s.user_agent}),i.jsxs("div",{className:"text-right d-flex justify-content-end",children:[i.jsx("span",{className:"me-4",onClick:e=>{K(s),J(!0)},children:i.jsx(r,{icon:t,size:"xl"})}),i.jsx(b,{color:"danger",className:"ms-auto",onClick:e=>W(s._id),children:"Logout"})]})]}),i.jsxs("div",{className:"d-block d-sm-flex",children:[i.jsxs("div",{className:"me-3 mb-2",children:[i.jsx("span",{className:"text-muted",children:"Last accessed"}),i.jsxs("span",{className:"d-block small",children:[s.last_accessed?p(s.last_accessed):"Never"," ","| ",s.active?"Verified":"Not verified"]})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted",children:"IP Address"}),i.jsx("span",{className:"d-block small text-capitalize",children:"::1"===s.ip_address?"localhost":s.ip_address})]})]})]})}),M>1&&i.jsx(j,{currentPage:T,setCurrentPage:F,totalPages:M,setTotalPages:O})]},e))),i.jsxs(v,{alignment:"center",scrollable:!0,visible:R,onClose:()=>G(!1),"aria-labelledby":"M",children:[i.jsx(y,{children:i.jsx(N,{children:"Confirm Logout?"})}),i.jsx(_,{children:"Are you sure you want to logout all sessions? This action cannot be undone."}),i.jsxs(k,{className:"d-flex justify-content-end",children:[i.jsx(b,{color:"secondary",onClick:s=>W(null),children:"Okay"}),i.jsx(b,{color:"primary",onClick:()=>{G(!1)},className:"ms-2",children:"Cancel"})]})]}),i.jsxs(v,{alignment:"center",scrollable:!0,visible:I,onClose:()=>J(!1),"aria-labelledby":"M",children:[i.jsx(y,{children:i.jsx(N,{children:null==E?void 0:E.user_agent})}),i.jsxs(_,{children:[i.jsx("strong",{children:"IP Address:"})," ",null==E?void 0:E.ip_address,i.jsx("div",{className:"mb-2 border-bottom"}),i.jsx("strong",{children:"Latitude:"})," ",(()=>{const s=(null==E?void 0:E.location)?JSON.parse(E.location):null;return i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:"Latitude:"})," ",s?s[0].latitude:0,i.jsx("div",{className:"mb-2 border-bottom"}),i.jsx("strong",{children:"Longitude:"})," ",s?s[0].longitude:0]})})(),i.jsx("div",{className:"mb-4 border-bottom"}),C&&i.jsx(i.Fragment,{children:(()=>{const s=(null==E?void 0:E.location)?JSON.parse(E.location):null,e=s?{lat:s[0].latitude,lng:s[0].longitude}:{lat:0,lng:0};return i.jsxs(i.Fragment,{children:[i.jsx(l,{mapContainerStyle:{height:"400px",width:"auto"},center:e,zoom:18,children:i.jsx(n,{position:e})}),i.jsx("p",{className:"text-muted mt-2",children:"Note: GPS accuracy may vary significantly on desktop or laptop devices compared to mobile phones."})]})})()})]})]}),i.jsx(a,{ref:S,size:"invisible",sitekey:d})]})};export{C as default};
